<?php
	// ###############################################################################################################
	// 				Function which holds the display logic of products under the combo to be shown when called using ajax;
	// ###############################################################################################################
	function show_product_details_list($enq_id,$alert='')
	{
		global $db,$ecom_siteid ;
		
		  // Get the list of products under current category group
		 $srno =1;
		$sqlp = "select  pr.products_product_id,pr.id,pr.product_text from product_enquiry_data pr where pr.product_enquiries_enquiry_id=".$enq_id." ";
		$resp=$db->query($sqlp);
		  ?>
		  <table width="100%" cellpadding="0" cellspacing="1" border="0">
				<?php
				if($alert)
				{
					?>
							<tr>
								<td  align="center" class="errormsg" colspan="5"><?php echo $alert?></td>
							</tr>
				 <?php
				}
				if ($db->num_rows($resp))
				{
				
				$table_headers = array('Slno.','Product_name','Retail','Cost','Discount');
				$header_positions=array('left','left','left','left','left');
				$colspan = count($table_headers);
				echo table_header($table_headers,$header_positions); 
				$cnt = 1;
				while ($rowp = $db->fetch_array($resp))
				{
					$sqlpr = "select product_id,product_name,product_webprice,product_costprice,product_discount from products where product_id=".$rowp['products_product_id']."";	
					$respr=$db->query($sqlpr);
					$rowpr = $db->fetch_array($respr);
					$rowv = $db->fetch_array($resv);
					$sql_msgs = "SELECT message_id,message_value ,message_caption
								FROM 
									product_enquiry_data_messages 
								WHERE 	
									product_enquiry_enquiry_id=".$rowp['id']." ";
				   $ret_msgs = $db->query($sql_msgs);
				   $vars_exists = false;
				   $sqlv = "select variable_name,variable_value from product_enquiry_data_vars where product_enquiry_data_id=".$rowp['id']."";	
					$resv=$db->query($sqlv);
					if($db->num_rows($resv) || $db->num_rows($ret_msgs)){
											$vars_exists 	= true;

					}
					$cls = ($cnt%2==0)?'listingtablestyleA':'listingtablestyleB';
				?>
					
					<tr>
		    		<td width="4%" align="left" valign="middle" class="<?=$cls;?>"  ><?php echo $srno++?></td>
			 		<td width="66%" align="left" valign="middle" class="<?=$cls;?>"  ><?php if($rowp['product_text']){?><img id="cat_imgtag" src="images/plus.gif" border="0"  onclick="display_prodtext(this,<?=$rowp['products_product_id']?>);">
					<? }?> <a href="home.php?request=products&checkbox[]=<? echo $rowpr['product_id'] ?>&fpurpose=edit" class="edittextlink"><? echo $rowpr['product_name']; ?></a>
					<?   if($vars_exists) { 
							 if($db->num_rows($resv)){
									while($rowv = $db->fetch_array($resv))
									{
									// If variables exists for current product, show it in the following section
									 if (trim($rowv['variable_value'])!='')
															print "<br><span class=''>".stripslashes($rowv['variable_name']).": ". stripslashes($rowv['variable_value'])."</span>"; 
														else
															print "<br><span class=''>".stripslashes($rowv['variable_name'])."</span>"; 
										
										
								 
								 
									 }
								  }
						 ?>
						 <?		  
							// Show the product messages if any
							 if ($db->num_rows($ret_msgs))
								{
									
									while($row_msgs = $db->fetch_array($ret_msgs))
									{
										if($row_msgs['message_value']!='') {
										  print "<br><span class=''>".stripslashes($row_msgs['message_caption']).": ". stripslashes($row_msgs['message_value'])."</span>"; 
										}
									}
								}
							}	?>					</td>
			  		<td width="9%" align="left" valign="middle" class="<?=$cls;?>"  ><?php echo display_price($rowpr['product_costprice'])?></td>
     		    	<td width="10%" align="left" valign="middle" class="<?=$cls;?>"  ><?php echo display_price($rowpr['product_webprice'])?></td>
		  			<td width="11%" align="left" valign="middle" class="<?=$cls;?>"  ><?php echo display_price($rowpr['product_discount'])?></td>
		 			</tr> 
					<tr id="<?=$rowp['products_product_id']?>" style="display:none;"><td class="<?=$cls;?>">&nbsp;</td><td align="left" colspan="<?=$colspan-1?>" class="details_td"><?= nl2br($rowp['product_text'])?></td></tr>
				     <?
				$cnt++;
				}
				}
				else
				{
				?>
				<tr>
								  <td colspan="5" align="center" valign="middle" class="norecordredtext_small">
  								  <input type="hidden" name="productcombo_norec" id="productcombo_norec" value="1" />
								  No Products </td>
								</tr>
				<?	
				}
				?>
				</table>
		
<?	}
function function_displaynote_add($enq_id)
{
global $db,$ecom_siteid ;
?>
 <table width="100%" border="0" cellspacing="2" cellpadding="2"  id="note_table" >
							<tr>
							  <td  valign="top" align="left">Specify your note here:</td>
						    </tr>
							<tr>
							  <td  valign="top"><textarea name="txt_note" cols="19" rows="6"></textarea></td>
						    </tr>
							<tr>
							  <td width="54%" align="right" valign="top"><input type="button" name="note_Submit" value="Save Note" class="red" onclick="if(document.frmListProductEnquiries.txt_note.value==''){ alert('Please specify the note'); } else { save_note_ajax(<?=$enq_id?>); }" /></td>
							</tr>
							
					  </table>
<?php
}
function show_note($enq_id,$alert)
{
global $db,$ecom_siteid ;
						// Get all the notes added for this enquiry
						$sql_notes = "SELECT note_id,date_format(a.note_addedon,'%d/%b/%Y %r') notedate,a.note,b.user_fname,b.user_lname FROM product_enquiry_notes a,sites_users_7584 b WHERE a.product_enquiries_enquiry_id=$enq_id AND 
						a.added_by = b.user_id ORDER BY note_addedon DESC ";
						$ret_notes = $db->query($sql_notes);
						?>
					 <table width="100%" border="0" cellspacing="2" cellpadding="2">
					  <?
					   if($alert){
					   ?>
					    <input type="hidden" name="alert_mess" id="alert_mess" value="<?=$alert?>"  />
						<?
						}
						if ($db->num_rows($ret_notes))
						{
							while ($row_notes = $db->fetch_array($ret_notes))
							{
					   ?>
                     
					 
					  <tr>
                      	<td width="94%" class="maininnertabletd1" align="left"><?php echo $row_notes['notedate']?></td>
                        <td width="6%" class="maininnertabletd1"><a href="#" onclick="if(confirm('Are you sure you want to remove this note?')) { delete_note(<?=$row_notes['note_id'] ?>,<?=$enq_id?>);}" title="Delete"><img src="images/del.gif" width="16" height="16" border="0" /></a></td>
                      </tr>
                      <tr>
                        <td colspan="2" align="left"><?php echo nl2br(stripslashes($row_notes['note']));?></td>
                      </tr>
                      <tr>
                        <td colspan="2" align="right">(<?php echo $row_notes['user_fname'].$row_notes['user_lname']?>) </td>
                      </tr>
                    
					<?php
							}
						}
						else
						{
					?>
							<tr>
							  <td colspan="2" align="center" class="redtext">No Notes added yet.</td>
							</tr>
							 <input type="hidden" name="enquiry_norec" id="enquiry_norec" value="1"  />
					<?php
						}
						?>
					  </table>
			<?		
}
    
?>	
